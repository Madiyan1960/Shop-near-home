<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .product {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      width: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .product img { width: 100%; border-radius: 6px; }
    .product button {
      margin-top: auto;
      background: #2e7d32;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .product button:hover { background: #1b5e20; }
    .product button.disabled { background: #ccc; cursor: not-allowed; }
    #cart { margin-top: 20px; border-top: 1px dashed #999; padding-top: 10px; }
    #cart ul { list-style: none; padding: 0; }
    #cart li { margin-bottom: 10px; }
    #cart button {
      background: #ff5722;
      color: white;
      padding: 5px 10px;
      border: none;
      cursor: pointer;
    }
    #cart button:hover { background: #e64a19; }
  </style>
</head>
<body>

<h2>üõçÔ∏è –ú–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</h2>
<div class="grid" id="products">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<h3>üß∫ –ö–æ—Ä–∑–∏–Ω–∞</h3>
<button onclick="downloadText()">üìÑ –°–∫–∞—á–∞—Ç—å –∑–∞–∫–∞–∑ (TXT)</button>
<button onclick="clearCart()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
<div id="cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>

<script>
const API_TOKEN = 'patH3Tqs7sTMEpo1G.f8d89a927a5f6e352cbe307be7a67e0e297ff32aaabf35e8115af646233845db'; // ‚Üê –í–ê–® PAT
const BASE_ID = 'appLj0ax0IDVaRTd4'; // ‚Üê –í–ê–® Base ID
const TABLE_NAME = '–¢–æ–≤–∞—Ä—ã';
const API_URL = `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`;
const HEADERS = { Authorization: `Bearer ${API_TOKEN}` };
const cart = [];

function renderCart() {
  const c = document.getElementById('cart');
  if (!cart.length) return c.innerHTML = '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞';

  let total = 0;
  c.innerHTML = '<ul>' + cart.map((item, index) => {
    total += item.price * item.quantity;
    return `
      <li>
        ${index + 1}. ${item.name} (${item.price} ‚Ç∏) √ó ${item.quantity}
        <button onclick="removeFromCart(${index})">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
        <button onclick="increaseQuantity(${index})">‚ûï –£–≤–µ–ª–∏—á–∏—Ç—å</button>
        <button onclick="decreaseQuantity(${index})">‚ûñ –£–º–µ–Ω—å—à–∏—Ç—å</button>
      </li>
    `;
  }).join('') + `</ul><b>–ò—Ç–æ–≥–æ: ${total} ‚Ç∏</b>`;
}

function addToCart(name, price) {
  const existingItem = cart.find(item => item.name === name);
  if (existingItem) {
    existingItem.quantity += 1;
  } else {
    cart.push({ name, price, quantity: 1 });
  }
  renderCart();
  disableButton(name);
}

function removeFromCart(index) {
  cart.splice(index, 1);
  renderCart();
  enableAllButtons();
}

function increaseQuantity(index) {
  cart[index].quantity += 1;
  renderCart();
}

function decreaseQuantity(index) {
  if (cart[index].quantity > 1) {
    cart[index].quantity -= 1;
    renderCart();
  }
}

function clearCart() {
  cart.length = 0;
  renderCart();
  enableAllButtons();
}

function disableButton(name) {
  const buttons = document.querySelectorAll(`button[data-name="${name}"]`);
  buttons.forEach(button => {
    button.classList.add('disabled');
    button.disabled = true;
  });
}

function enableAllButtons() {
  document.querySelectorAll('button').forEach(button => {
    button.classList.remove('disabled');
    button.disabled = false;
  });
}

fetch(API_URL, { headers: HEADERS })
  .then(r => r.json())
  .then(data => {
    const p = document.getElementById('products');
    p.innerHTML = '';
    data.records.forEach(r => {
      const f = r.fields;
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <img src="${f['–§–æ—Ç–æ']?.[0]?.url || ''}" alt="">
        <div><b>${f['–ù–∞–∑–≤–∞–Ω–∏–µ']}</b></div>
        <div>${f['–¶–µ–Ω–∞']} —Ç–≥</div>
        <button data-name="${f['–ù–∞–∑–≤–∞–Ω–∏–µ']}" onclick="addToCart('${f['–ù–∞–∑–≤–∞–Ω–∏–µ']}', ${f['–¶–µ–Ω–∞']})">–î–æ–±–∞–≤–∏—Ç—å</button>
      `;
      p.appendChild(div);
    });
  })
  .catch(() => document.getElementById('products').innerText = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');

function downloadText() {
  let text = "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ú–∞–¥—å—è–Ω!\n\n–í–∞—à –∑–∞–∫–∞–∑:\n";

  let total = 0;
  cart.forEach((item, index) => {
    text += `${index + 1}. ${item.name} (${item.price} ‚Ç∏) √ó ${item.quantity}\n`;
    total += item.price * item.quantity;
  });

  text += `\n–°—É–º–º–∞: ${total} ‚Ç∏\n`;
  text += "–ê–¥—Ä–µ—Å: –ê—Å—Ç–∞–Ω–∞ —É–ª. –ö–∞–±–∞–Ω–±–∞–π –±–∞—Ç—ã—Ä–∞ 10\n";

  const blob = new Blob([text], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'zakaz.txt';
  link.click();
}
</script>

</body>
</html>
