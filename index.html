<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ú–∞–≥–∞–∑–∏–Ω —É –¥–æ–º–∞</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body { font-family: sans-serif; margin: 1rem; background: #f4f4f4; }
    h1 { text-align: center; color: #2e7d32; }
    .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
    .product { background: white; padding: 1rem; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); position: relative; }
    .product img { width: 100%; height: 150px; object-fit: cover; border-radius: 8px; }
    .product h3 { margin: 0.5rem 0 0.2rem; }
    .product p { margin: 0; color: #555; }
    .add-btn { margin-top: 0.5rem; padding: 0.4rem 0.6rem; background: #2e7d32; color: white; border: none; border-radius: 6px; cursor: pointer; }
    #cart-button { position: fixed; top: 1rem; right: 1rem; background: #388e3c; color: white; border: none; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; z-index: 100; }
    #cart-modal { display: none; position: fixed; top: 60px; right: 20px; background: white; border: 1px solid #ccc; padding: 1rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); max-width: 300px; z-index: 1000; }
    #cart-items p { margin: 0.5rem 0; }
  </style>
</head>
<body>
  <h1>–ú–∞–≥–∞–∑–∏–Ω —É –¥–æ–º–∞</h1>
  <button id="cart-button">–ö–æ—Ä–∑–∏–Ω–∞ (0)</button>
    <div id="cart-modal">
    <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
    <div id="cart-items"></div>
      <!-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–∞—Ç–µ–ª—è -->
    <p><label for="name">–ò–º—è:</label><input type="text" id="name" /></p>
<p><label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label><input type="text" id="phone" /></p>
<p><label for="address">–ê–¥—Ä–µ—Å:</label><input type="text" id="address" /></p>

     
    <button onclick="openPreFilledForm()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>
  <div id="product-list" class="product-list"></div>
  
  

 
  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoChjmnMdjDn-siHAEHrBpDaz-3tkFx68Peo1LXU_Nc8R5XTm5Gee2pi-O9jz1XyYhhCGCDnTKa0cR/pub?gid=0&single=true&output=csv";
 
 let cart = [];

  function saveCart() {
    localStorage.setItem("cart", JSON.stringify(cart));
  }

  function loadCart() {
  const data = localStorage.getItem("cart");
  if (data) {
    try {
      cart = JSON.parse(data).map(item => ({
        ...item,
        count: item.count ?? 1 // –µ—Å–ª–∏ count –Ω–µ—Ç ‚Äî —Å—Ç–∞–≤–∏–º 1
      }));
    } catch (e) {
      cart = [];
    }
  }
}

  function getTotalCount() {
    return cart.reduce((sum, item) => sum + item.count, 0);
  }

  function updateCartButton() {
    document.getElementById("cart-button").textContent = `–ö–æ—Ä–∑–∏–Ω–∞ (${getTotalCount()})`;
  }

 function showCart() {
  const modal = document.getElementById("cart-modal");
  modal.style.display = modal.style.display === "block" ? "none" : "block";

  const container = document.getElementById("cart-items");
  container.innerHTML = "";

  cart.forEach((p, index) => {
    const item = document.createElement("div");
    item.innerHTML = `
      <p>
        ${p.name} ‚Äì ${p.price} √ó ${p.count}
        <button onclick="changeCount(${index}, 1)">+</button>
        <button onclick="changeCount(${index}, -1)">‚àí</button>
        <button onclick="removeItem(${index})">üóë</button>
      </p>
    `;
    container.appendChild(item);
 
  const total = getTotalPrice();
  const totalDiv = document.createElement("div");
  totalDiv.innerHTML = `
    <hr>
    <strong>–ò—Ç–æ–≥–æ: ${total} ‚Ç∏</strong><br><br>
    <button onclick="clearCart()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
  `;
  container.appendChild(totalDiv);
   // üëâ –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
  
}
   

  saveCart();
  updateCartButton();
  showCart(); // –æ–±–Ω–æ–≤–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
}

function removeItem(index) {
  cart.splice(index, 1);
  saveCart();
  updateCartButton();
  showCart(); // –æ–±–Ω–æ–≤–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
}


  async function loadProductsFromCSV() {
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const lines = text.trim().split("\n");
    const products = lines.slice(1).map(line => {
      const [name, price, image] = line.split(",");
      return { name, price, image };
    });

    const list = document.getElementById("product-list");
    list.innerHTML = "";
    products.forEach(p => {
      const el = document.createElement("div");
      el.className = "product";
      el.innerHTML = `
        <img src="${p.image}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p>${p.price}</p>
        <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
      `;
      el.querySelector(".add-btn").addEventListener("click", () => {
        const existing = cart.find(item => item.name === p.name);
        if (existing) {
          existing.count += 1;
        } else {
          cart.push({ ...p, count: 1 });
        }
        saveCart();
        updateCartButton();
      });
      list.appendChild(el);
    });
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  loadCart();
  updateCartButton();
  document.getElementById("cart-button").addEventListener("click", showCart);
  loadProductsFromCSV();

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }
function getTotalPrice() {
  return cart.reduce((sum, item) => {
    const price = parseInt(item.price.replace(/\D/g, ""), 10); // —É–±–∏—Ä–∞–µ–º –≤—Å—ë, –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
    return sum + price * item.count;
  }, 0);
}
// –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∏–ª–∏ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞
function changeCount(index, delta) {
  cart[index].count += delta;
  if (cart[index].count <= 0) {
    cart.splice(index, 1); // —É–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä, –µ—Å–ª–∏ —Å—Ç–∞–ª–æ 0
  }
  saveCart();          // —Å–æ—Ö—Ä–∞–Ω—è–µ–º
  updateCartButton();  // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ö–æ—Ä–∑–∏–Ω–∞"
  showCart();          // –æ–±–Ω–æ–≤–ª—è–µ–º –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã
}

// –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é
function removeItem(index) {
  cart.splice(index, 1);  // —É–¥–∞–ª—è–µ–º –ø–æ –Ω–æ–º–µ—Ä—É
  saveCart();
  updateCartButton();
  showCart();
}

// –°—á–∏—Ç–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
function getTotalPrice() {
  return cart.reduce((sum, item) => {
    const price = parseInt(item.price.replace(/\D/g, ""), 10); // –±–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏–∑ "250 ‚Ç∏"
    return sum + price * item.count;
  }, 0);
}
function clearCart() {
  cart = []; // –æ—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤
  saveCart(); // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Å—Ç—É—é –∫–æ—Ä–∑–∏–Ω—É
  updateCartButton(); // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ö–æ—Ä–∑–∏–Ω–∞"
  showCart(); // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –æ–∫–Ω–æ
}
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
function loadUserData() {
  const savedData = JSON.parse(localStorage.getItem("userData"));
  const userSelect = document.getElementById("saved-user");

  if (savedData) {
    savedData.forEach(user => {
      const option = document.createElement("option");
      option.value = user.name;
      option.textContent = `${user.name} - ${user.phone} - ${user.address}`;
      userSelect.appendChild(option);
    });
  }
}



});

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
loadUserData();

function openPreFilledForm() {
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const address = document.getElementById("address").value;
 
   // –ò–∑–º–µ–Ω—è–µ–º —Å—Ç—Ä–æ–∫—É –∑–∞–∫–∞–∑–∞, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∞—Ç—å —Ü–µ–Ω—É –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
  const order = cart.map(p => `${p.name} (${p.price}) √ó ${p.count}`).join(", ");
  const total = getTotalPrice();
  const status = "–û—Ñ–æ—Ä–º–ª–µ–Ω";
  
  
  if (!name || !phone || !address) {
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∞–¥—Ä–µ—Å.");
    return;
  }

  const base = "https://docs.google.com/forms/d/e/1FAIpQLSegQ5wqbLaMU094d5y1EqfGDYedlBa362BoqFeBfA-RXiAQqg/viewform";
  const params = new URLSearchParams({
    "entry.1735845883": name,
    "entry.422081956": phone,
    "entry.1694441696": address,
    "entry.1899533559": order,
    "entry.315266378": total,
    "entry.1207854373": status
  });

  window.open(`${base}?${params.toString()}`, "_blank");
}

    
</script>
 
</body>
</html>
