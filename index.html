<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .product {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      width: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .product img { width: 100%; border-radius: 6px; }
    .product button {
      margin-top: auto;
      background: #2e7d32;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .product button:hover { background: #1b5e20; }
    #cart { margin-top: 20px; border-top: 1px dashed #999; padding-top: 10px; }
  </style>
</head>
<body>

<h2>üõçÔ∏è –ú–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</h2>
<div class="grid" id="products">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<h3>üß∫ –ö–æ—Ä–∑–∏–Ω–∞</h3>
<button onclick="downloadPDF()">üìÑ –°–∫–∞—á–∞—Ç—å –∑–∞–∫–∞–∑ (PDF)</button>
<div id="cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>

<script>
const API_TOKEN = 'patH3Tqs7sTMEpo1G.f8d89a927a5f6e352cbe307be7a67e0e297ff32aaabf35e8115af646233845db'; // ‚Üê –í–ê–® PAT
const BASE_ID = 'appLj0ax0IDVaRTd4'; // ‚Üê –í–ê–® Base ID
const TABLE_NAME = '–¢–æ–≤–∞—Ä—ã';
const API_URL = `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`;
const HEADERS = { Authorization: `Bearer ${API_TOKEN}` };
const cart = [];

function renderCart() {
  const c = document.getElementById('cart');
  if (!cart.length) return c.innerHTML = '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞';
  let total = 0;
  c.innerHTML = '<ul>' + cart.map(i => {
    total += i.price;
    return `<li>${i.name} ‚Äì ${i.price} —Ç–≥</li>`;
  }).join('') + `</ul><b>–ò—Ç–æ–≥–æ: ${total} —Ç–≥</b>`;
}

function addToCart(name, price) {
  cart.push({ name, price });
  renderCart();
}

fetch(API_URL, { headers: HEADERS })
  .then(r => r.json())
  .then(data => {
    const p = document.getElementById('products');
    p.innerHTML = '';
    data.records.forEach(r => {
      const f = r.fields;
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <img src="${f['–§–æ—Ç–æ']?.[0]?.url || ''}" alt="">
        <div><b>${f['–ù–∞–∑–≤–∞–Ω–∏–µ']}</b></div>
        <div>${f['–¶–µ–Ω–∞']} —Ç–≥</div>
        <button onclick="addToCart('${f['–ù–∞–∑–≤–∞–Ω–∏–µ']}', ${f['–¶–µ–Ω–∞']})">–î–æ–±–∞–≤–∏—Ç—å</button>
      `;
      p.appendChild(div);
    });
  })
  .catch(() => document.getElementById('products').innerText = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');

// –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç DejaVuSans
const dejavuFont = `AAEAAAASAQAABAAgR0RFRrRCsIIAAACcAAAAYGNtYXAAAwAAAAFcAAAACGdseWZ4HhF8AAABHAAAA...
...`; // ‚Üê –ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ base64 —à—Ä–∏—Ñ—Ç–∞

window.jspdf.jsPDF.API.events.push(['addFonts', function () {
  this.addFileToVFS('DejaVuSans.ttf', dejavuFont);
  this.addFont('DejaVuSans.ttf', 'DejaVuSans', 'normal');
}]);

function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFont('DejaVuSans');
  doc.setFontSize(14);
  let y = 10;

  doc.text("üßæ –ó–∞–∫–∞–∑ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞", 10, y);
  y += 10;

  let total = 0;
  cart.forEach(item => {
    doc.text(`${item.name} ‚Äì ${item.price} —Ç–≥`, 10, y);
    y += 8;
    total += item.price;
  });

  doc.setFontSize(12);
  doc.text(`–ò—Ç–æ–≥–æ: ${total} —Ç–≥`, 10, y + 5);

  doc.save("zakaz.pdf");
}
</script>

</body>
</html>
