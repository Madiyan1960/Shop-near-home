<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .product {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      width: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .product img { width: 100%; border-radius: 6px; }
    .product button {
      margin-top: auto;
      background: #2e7d32;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .product button:hover { background: #1b5e20; }
    #cart { margin-top: 20px; border-top: 1px dashed #999; padding-top: 10px; }
    #order-form { margin-top: 20px; }
    input, button { padding: 5px; margin: 5px 0; width: 300px; }
    button:disabled {
      background-color: gray;
      cursor: not-allowed;
    }
    h3, h2 { margin-bottom: 10px; }
  </style>
</head>
<body>

  <h2>üõçÔ∏è –ú–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</h2>
<div class="grid" id="products">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<h3>üß∫ –ö–æ—Ä–∑–∏–Ω–∞</h3>
<div id="cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>

<h3>üì¶ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞</h3>
<div id="order-form">
  <input type="text" id="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required>
  <input type="text" id="phone" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ñ–æ—Ä–º–∞—Ç: 87001234567)" required>
  <input type="text" id="address" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å" required>
  <button id="send-order" onclick="sendOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>

<script>
const API_TOKEN = 'patH3Tqs7sTMEpo1G.f8d89a927a5f6e352cbe307be7a67e0e297ff32aaabf35e8115af646233845db'; // –í—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π API —Ç–æ–∫–µ–Ω
const BASE_ID = 'appLj0ax0IDVaRTd4'; // –í—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π Base ID
const PRODUCTS_TABLE = '–¢–æ–≤–∞—Ä—ã';
const ORDERS_TABLE = '–ó–∞–∫–∞–∑—ã'; // –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
const API_URL = `https://api.airtable.com/v0/${BASE_ID}/${PRODUCTS_TABLE}`;
const ORDERS_URL = `https://api.airtable.com/v0/${BASE_ID}/${ORDERS_TABLE}`;
const HEADERS = { Authorization: `Bearer ${API_TOKEN}` };
const cart = [];

function renderCart() {
  const c = document.getElementById('cart');
  if (!cart.length) return c.innerHTML = '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞';
  let total = 0;
  c.innerHTML = '<ul>' + cart.map((item, index) => {
    total += item.price * item.quantity;
    return `<li>${index + 1}. ${item.name} ‚Äì ${item.price} —Ç–≥ √ó ${item.quantity}</li>`;
  }).join('') + `</ul><b>–ò—Ç–æ–≥–æ: ${total} —Ç–≥</b>`;
}

function addToCart(name, price) {
  const existingItem = cart.find(item => item.name === name);
  if (existingItem) {
    existingItem.quantity += 1;
  } else {
    cart.push({ name, price, quantity: 1 });
  }
  renderCart();
}

function removeFromCart(name) {
  const index = cart.findIndex(item => item.name === name);
  if (index > -1) {
    cart.splice(index, 1);
  }
  renderCart();
}

function sendOrder() {
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const address = document.getElementById('address').value;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
  if (!name || !phone || !address) {
    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.");
    return;
  }

  // –ü—Ä–æ—Å—Ç–æ–π —Ä–µ–≥–µ–∫—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const phonePattern = /^[8]7[0-9]{9}$/;
  if (!phonePattern.test(phone)) {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞.");
    return;
  }

  const orderData = {
    fields: {
      Name: name,
      Phone: phone,
      Address: address,
      Products: cart.map(item => `${item.name} ‚Äì ${item.price} —Ç–≥ √ó ${item.quantity}`).join('\n'),
      Total: cart.reduce((total, item) => total + (item.price * item.quantity), 0),
     
    }
  };

  fetch(ORDERS_URL, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${API_TOKEN}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(orderData)
  })
  .then(response => response.json())
  .then(data => {
    alert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
    // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –∏ —Ñ–æ—Ä–º—É
    cart.length = 0;
    renderCart();
    document.getElementById('name').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('address').value = '';
  })
  .catch(error => {
    console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞:", error);
    alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
  });
}

fetch(API_URL, { headers: HEADERS })
  .then(r => r.json())
  .then(data => {
    const p = document.getElementById('products');
    p.innerHTML = '';
    data.records.forEach(r => {
      const f = r.fields;
      const div = document.createElement('div');
      div.className = 'product';
     
      div.innerHTML = `
  <img src="${f['Image']?.[0]?.url || ''}" alt="">
  <div><b>${f['Name']}</b></div>
  <div>${f['Price']} —Ç–≥</div>
  <button onclick="addToCart('${f['Name']}', ${f['Price']})">–î–æ–±–∞–≤–∏—Ç—å</button>
`;
    p.appendChild(div);
    });
  })
  .catch(() => document.getElementById('products').innerText = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
</script>

</body>
</html>
